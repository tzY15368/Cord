syntax = "proto2";

option go_package = "proto";

message GenericArgs {
    enum Method {
        AppendEntries = 0;
        RequestVote = 1;
        InstallSnapshot = 2;
    }
    required Method method = 1;
    required bytes data = 2;
}

message GenericReply {
    required bytes data = 1;
}

service GenericService {
    rpc HandleCall (GenericArgs) returns (GenericReply);
}

// message SMOperation {

// }

message RequestInfo {
    required int64 clientID = 1;
    required int64 requestID = 2;
}

message CmdArgs {
    enum OPType {
        GET = 0;
        PUT = 1;
        APPEND = 2;
        WATCH = 3;
        LEASE = 4;
    }
    required OPType opType = 1;
    required string opKey = 2;
    required string opVal = 3;
}

message ServiceArgs {
    repeated CmdArgs cmds = 1;
    required RequestInfo info = 4;
    optional bool linearizable = 5;// 如果是false，则cmds里任意写都不走raft同步，不保证一致性读
}

service ExternalService {
    rpc HandleRequest (ServiceArgs) returns (ServiceReply);
}

message ServiceReply {
    map<string, string> result = 2;
}

message TempKVStore {
    map<string, string> data = 1;
}

message AckMap {
    map<int64, int64> ack = 1;
}